// package.json
{
  "name": "fortcompanion",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "fetch:patches": "node scripts/fetchPatches.js",
    "generate:all-guides": "node scripts/generateAllGuides.js"
  },
  "dependencies": {
    "axios": "^1.3.4",
    "next": "13.4.7",
    "openai": "^4.0.0",
    "react": "18.2.0",
    "react-dom": "18.2.0",
    "tailwindcss": "^3.3.2",
    "@heroicons/react": "^2.0.18",
    "node-cron": "^3.0.2"
  }
}

// tailwind.config.js
module.exports = {
  content: [
    "./pages/**/*.{js,jsx}",
    "./components/**/*.{js,jsx}"
  ],
  theme: {
    extend: {
      backgroundImage: {
        'map': "url('/assets/fortnite-map.jpg')"
      }
    }
  },
  plugins: [
    require('@tailwindcss/typography'),
  ],
}

// next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  experimental: { appDir: true },
};
module.exports = nextConfig;

// .github/workflows/daily_update.yml
name: Daily Data & AI Refresh

on:
  schedule:
    - cron: '0 3 * * *'  # 3 AM UTC daily

jobs:
  refresh:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install deps
        run: npm ci
      - name: Fetch latest patch notes & data
        run: npm run fetch:patches && npm run generate:all-guides
      - name: Commit changes
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add data/
          git commit -m "Daily data & AI update" || echo "No changes"
      - name: Push & Deploy
        uses: ad-m/github-push-action@v0.6.0
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}

// scripts/fetchPatches.js
const fs = require('fs');
const axios = require('axios');
(async () => {
  const res = await axios.get('https://fortnite-api.com/v2/news');
  fs.writeFileSync('data/patches.json', JSON.stringify(res.data, null, 2));
})();

// scripts/generateAllGuides.js
const fs = require('fs');
const OpenAI = require('openai');
const openai = new OpenAI({ apiKey: process.env.OPENAI_KEY });
const topics = ['best solo drop Chapter 4','meta loadout','week 5 challenges'];
(async () => {
  const guides = {};
  for (let t of topics) {
    const completion = await openai.chat.completions.create({
      model: 'gpt-4o',
      messages: [
        { role: 'system', content: 'You are a Fortnite expert.' },
        { role: 'user', content: `Write a pro guide on ${t}.` }
      ]
    });
    guides[t] = completion.choices[0].message.content;
  }
  fs.writeFileSync('data/guides.json', JSON.stringify(guides, null, 2));
})();

// data/poi.json
[
  { "id": 1, "name": "Tilted Towers", "x": "30%", "y": "40%", "description": "High loot, high risk.", "image": "/assets/tilted.jpg" },
  { "id": 2, "name": "Sweaty Sands",  "x": "60%", "y": "70%", "description": "Beachside battles.", "image": "/assets/sweaty.jpg" }
]

// data/weapons.json
[
  { "id": 1, "name": "SCAR" },
  { "id": 2, "name": "Pump Shotgun" },
  { "id": 3, "name": "Sniper Rifle" }
]

// data/cosmetics.json
[
  { "id": 1, "name": "Reaper", "rarity": "Legendary", "image": "/assets/reaper.png" },
  { "id": 2, "name": "Galaxy", "rarity": "Epic", "image": "/assets/galaxy.png" }
]

// pages/_app.js
import '../styles/globals.css';
import Link from 'next/link';

function MyApp({ Component, pageProps }) {
  return (
    <>
      <nav className="bg-gray-800 text-white p-4 flex space-x-4 overflow-x-auto">
        {[
          'Map','Shop','Cosmetics','Stats','Guides',
          'Loadout','XP Calculator','Lorebook','Season Countdown','Community'
        ].map(s => (
          <Link key={s} href={`/${s.toLowerCase().replace(/ /g,'-')}`}>
            <a className="hover:underline">{s}</a>
          </Link>
        ))}
      </nav>
      <Component {...pageProps} />
    </>
  );
}

export default MyApp;

// pages/index.js
export default function Home() {
  return (
    <div className="flex flex-col items-center justify-center h-screen bg-gradient-to-b from-purple-900 to-blue-900 text-white">
      <h1 className="text-6xl font-extrabold mb-6">FortCompanion</h1>
      <p className="text-xl">Your all-in-one, live & AI-driven Fortnite companion.</p>
    </div>
  );
}

// pages/map.js
import MapViewer from '../components/MapViewer';
export default function MapPage() { return <MapViewer />; }

// pages/shop.js
import axios from 'axios';
import { useEffect, useState } from 'react';
export default function ShopPage() {
  const [items, setItems] = useState([]);
  useEffect(() => {
    axios.get('/api/fortnite/store')
      .then(res => setItems(res.data.items || []));
  }, []);
  return (
    <div className="p-4 grid grid-cols-3 gap-4">
      {items.map(i => (
        <div key={i.itemId} className="bg-gray-800 text-white p-4 rounded">
          <img src={i.images.featured} alt="" className="w-full h-32 object-cover rounded" />
          <h3 className="mt-2">{i.name}</h3>
          <p>{i.cost} V-Bucks</p>
        </div>
      ))}
    </div>
  );
}

// pages/cosmetics.js
import CosmeticsGallery from '../components/CosmeticsGallery';
export default function CosmeticsPage() { return <CosmeticsGallery />; }

// pages/locker.js
import { useEffect, useState } from 'react';
import axios from 'axios';
export default function LockerPage() {
  const [locker, setLocker] = useState([]);
  useEffect(() => {
    axios.get('/api/fortnite/locker').then(r => setLocker(r.data.items));
  }, []);
  return (
    <div className="p-4 grid grid-cols-4 gap-4">
      {locker.map(c => (
        <div key={c.id} className="text-center">
          <img src={c.images.icon} alt="" className="w-full h-24 object-contain" />
          <p className="mt-1">{c.name}</p>
        </div>
      ))}
    </div>
  );
}

// pages/stats/[mode].js
import StatsDashboard from '../../components/StatsDashboard';
import { useRouter } from 'next/router';
export default function ModeStats() {
  const { mode } = useRouter().query;
  return <StatsDashboard mode={mode} />;
}

// pages/guides.js
import GuideGenerator from '../components/GuideGenerator';
export default function GuidesPage() { return <GuideGenerator />; }

// pages/loadout.js
import LoadoutBuilder from '../components/LoadoutBuilder';
export default function LoadoutPage() { return <LoadoutBuilder />; }

// pages/xp-calculator.js
import XP_Calculator from '../components/XP_Calculator';
export default function XPPage() { return <XP_Calculator />; }

// pages/lorebook.js
import Lorebook from '../components/Lorebook';
export default function LorePage() { return <Lorebook />; }

// pages/season-countdown.js
import { useEffect, useState } from 'react';
export default function SeasonCountdown() {
  const [time, setTime] = useState('');
  useEffect(() => {
    const target = new Date('2025-08-01T00:00:00Z').getTime();
    const tick = () => {
      const diff = target - Date.now();
      if (diff < 0) return setTime('Live!');
      const d = Math.floor(diff/86400000);
      const h = Math.floor((diff%86400000)/3600000);
      const m = Math.floor((diff%3600000)/60000);
      setTime(`${d}d ${h}h ${m}m`);
    };
    tick(); const id = setInterval(tick,60000);
    return () => clearInterval(id);
  }, []);
  return <div className="text-4xl p-8">{time}</div>;
}

// pages/community.js
export default function CommunityPage() {
  return (
    <div className="p-8">
      <h2 className="text-2xl mb-4">Creator Hub</h2>
      <p>Coming soon: social feed, guide sharing, tournaments & more.</p>
    </div>
  );
}

// pages/api/fortnite/[endpoint].js
import axios from 'axios';
export default async function handler(req, res) {
  const { endpoint } = req.query;
  try {
    const { data } = await axios.get(
      `https://api.fortnitetracker.com/v1/${endpoint}`,
      { headers: { 'TRN-Api-Key': process.env.FORTNITE_TRACKER_KEY } }
    );
    res.status(200).json(data);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
}

// pages/api/ai/generate-guide.js
import OpenAI from 'openai';
const openai = new OpenAI({ apiKey: process.env.OPENAI_KEY });
export default async function handler(req, res) {
  const { topic } = req.body;
  const completion = await openai.chat.completions.create({
    model: 'gpt-4o',
    messages: [
      { role: 'system', content: 'You are a Fortnite expert.' },
      { role: 'user', content: `Write a pro guide on ${topic}.` }
    ]
  });
  res.status(200).json({ guide: completion.choices[0].message.content });
}

// components/MapViewer.jsx
import { useState } from 'react';
import POIData from '../data/poi.json';
export default function MapViewer() {
  const [selected, setSelected] = useState(null);
  return (
    <div className="relative w-full h-screen bg-map bg-cover">
      {POIData.map(p => (
        <button
          key={p.id}
          className="absolute"
          style={{ top: p.y, left: p.x }}
          onClick={() => setSelected(p)}
        >üìç</button>
      ))}
      {selected
